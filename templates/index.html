<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Backstock Inventory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style>
      /* Global Styles */
      body {
        padding-bottom: 80px; /* Space for footer */
        font-size: 16px; /* Better base font size for mobile */
      }

      .container {
        max-width: 1200px;
        padding: 15px;
      }

      /* Header */
      h1 {
        font-size: 2.4rem;
        margin-bottom: 20px;
      }

      h4 {
        margin-top: 15px;
        margin-bottom: 15px;
      }

      /* Menu Buttons */
      .menu-section {
        margin-bottom: 30px;
      }

      .menu-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
        clear: both;
      }

      .btn-menu {
        background-color: #CE2029;
        border-color: #CE2029;
        color: white;
        width: 100%;
        min-height: 44px; /* Better touch target */
        font-size: 16px;
        padding: 10px 15px;
        display: block;
      }

      .btn-menu:hover,
      .btn-menu:focus {
        background-color: #a31920;
        border-color: #a31920;
        color: white;
      }

      /* CSV Upload Section */
      .csv-upload {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 25px;
        width: 100%;
        clear: both;
      }

      .csv-upload label {
        font-weight: bold;
        margin-bottom: 8px;
      }

      .csv-upload input[type="submit"] {
        margin-top: 10px;
        min-height: 44px;
        padding: 10px 20px;
        background-color: #CE2029;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .csv-upload input[type="submit"]:hover {
        background-color: #a31920;
      }

      /* Forms */
      .form-section {
        max-width: 600px;
        margin: 0 auto;
      }

      .form-group label {
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
      }

      .form-control {
        width: 100%;
        max-width: 100%;
        min-height: 44px;
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 10px;
      }

      select.form-control {
        height: 44px;
      }

      .btn-success {
        min-height: 44px;
        padding: 10px 30px;
        font-size: 16px;
        margin-top: 10px;
      }

      /* Results Display */
      .results-section {
        margin-top: 20px;
      }

      .item-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .item-card h5 {
        margin: 0 0 10px 0;
        font-size: 1rem;
        word-wrap: break-word;
      }

      .item-detail {
        margin: 5px 0;
        font-size: 0.9rem;
      }

      .item-detail strong {
        display: inline-block;
        min-width: 120px;
      }

      /* Error Messages */
      .error-message {
        color: #d9534f;
        background-color: #f2dede;
        border: 1px solid #ebccd1;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
      }

      /* Success Messages */
      .success-message {
        color: #3c763d;
        background-color: #dff0d8;
        border: 1px solid #d6e9c6;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
      }

      /* Footer */
      .page-footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #f8f9fa;
        border-top: 1px solid #dee2e6;
        padding: 15px;
        text-align: center;
        font-size: 0.9rem;
        z-index: 1000;
      }

      .page-footer p {
        margin: 0;
      }

      /* Mobile Optimizations */
      @media (max-width: 768px) {
        h1 {
          font-size: 2rem;
        }

        .menu-buttons {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .csv-upload {
          margin-bottom: 20px;
        }

        .container {
          padding: 10px;
        }

        .item-detail strong {
          display: block;
          margin-bottom: 2px;
        }

        .page-footer {
          font-size: 0.8rem;
          padding: 10px 5px;
        }
      }

      /* Tablet Optimizations */
      @media (min-width: 769px) and (max-width: 1024px) {
        .menu-buttons {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Random Item Count Selector Styles */
      .random-count-selector {
        margin-bottom: 10px;
        width: 100%;
      }

      .random-count-selector label {
        font-weight: bold;
        margin-bottom: 8px;
        display: block;
        font-size: 14px;
      }

      .range-selector-wrapper {
        display: flex;
        align-items: center;
        gap: 12px;
        width: 100%;
      }

      .range-selector {
        flex: 1;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        background: linear-gradient(to right, #CE2029 0%, #CE2029 var(--range-progress, 10%), #dee2e6 var(--range-progress, 10%), #dee2e6 100%);
        border-radius: 4px;
        outline: none;
        cursor: pointer;
      }

      .range-selector::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        background: #CE2029;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid white;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .range-selector::-webkit-slider-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      }

      .range-selector::-moz-range-thumb {
        width: 24px;
        height: 24px;
        background: #CE2029;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid white;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .range-selector::-moz-range-thumb:hover {
        transform: scale(1.1);
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
      }

      .range-selector:focus {
        outline: 2px solid #CE2029;
        outline-offset: 4px;
      }

      .count-display {
        min-width: 50px;
        text-align: center;
        font-weight: bold;
        font-size: 18px;
        color: #CE2029;
        background: #f8f9fa;
        padding: 6px 12px;
        border-radius: 4px;
        border: 2px solid #CE2029;
      }

      .range-labels {
        display: flex;
        justify-content: space-between;
        font-size: 12px;
        color: #666;
        margin-top: 4px;
        padding: 0 2px;
      }

      /* Mobile adjustments for range selector */
      @media (max-width: 768px) {
        .range-selector-wrapper {
          flex-direction: column;
          gap: 8px;
        }

        .range-selector {
          width: 100%;
          height: 12px;
        }

        .range-selector::-webkit-slider-thumb {
          width: 32px;
          height: 32px;
        }

        .range-selector::-moz-range-thumb {
          width: 32px;
          height: 32px;
        }

        .count-display {
          font-size: 20px;
          padding: 8px 16px;
        }

        .random-count-selector label {
          font-size: 16px;
        }
      }

      /* Visualization Selector Styles */
      .viz-selector-container {
        margin-bottom: 10px;
        width: 100%;
      }

      .viz-dropdown {
        position: relative;
        width: 100%;
      }

      .viz-dropdown-toggle {
        width: 100%;
        min-height: 44px;
        padding: 10px 15px;
        background-color: white;
        border: 2px solid #CE2029;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
        color: #333;
        transition: all 0.3s;
      }

      .viz-dropdown-toggle:hover {
        background-color: #f8f9fa;
        border-color: #a31920;
      }

      .viz-dropdown-toggle:focus {
        outline: 2px solid #CE2029;
        outline-offset: 2px;
      }

      .viz-caret {
        font-size: 12px;
        transition: transform 0.3s;
      }

      .viz-dropdown-toggle.open .viz-caret {
        transform: rotate(180deg);
      }

      .viz-dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        margin-top: 5px;
        background-color: white;
        border: 2px solid #CE2029;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
      }

      .viz-dropdown-menu.show {
        display: block;
      }

      .viz-dropdown-header {
        padding: 12px 15px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
      }

      .viz-dropdown-divider {
        height: 1px;
        background-color: #dee2e6;
        margin: 0;
      }

      .viz-checkbox-label {
        display: block;
        padding: 12px 15px;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s;
        font-size: 16px;
      }

      .viz-checkbox-label:hover {
        background-color: #f8f9fa;
      }

      .viz-checkbox-label input[type="checkbox"] {
        margin-right: 10px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        vertical-align: middle;
      }

      /* Mobile-specific adjustments */
      @media (max-width: 768px) {
        .viz-dropdown-menu {
          max-height: 300px;
        }

        .viz-checkbox-label {
          padding: 14px 15px;
          font-size: 16px;
        }

        .viz-checkbox-label input[type="checkbox"] {
          width: 20px;
          height: 20px;
        }
      }

      /* Info Tooltip Styles */
      .field-label-wrapper {
        display: flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 5px;
      }

      .field-label-wrapper label {
        margin-bottom: 0;
      }

      .info-tooltip-container {
        position: relative;
        display: inline-flex;
        align-items: center;
      }

      .info-tooltip-icon {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 18px;
        height: 18px;
        background-color: #6c757d;
        color: white;
        border-radius: 50%;
        font-size: 12px;
        font-weight: bold;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s;
        line-height: 1;
      }

      .info-tooltip-icon:hover {
        background-color: #495057;
      }

      .info-tooltip-box {
        position: absolute;
        top: calc(100% + 8px);
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: white;
        padding: 10px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: normal;
        line-height: 1.4;
        min-width: 200px;
        max-width: 280px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1001;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.2s, visibility 0.2s;
        text-align: left;
      }

      .info-tooltip-box::before {
        content: '';
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-bottom-color: #333;
      }

      .info-tooltip-box.show {
        visibility: visible;
        opacity: 1;
      }

      .info-tooltip-box .tooltip-title {
        font-weight: bold;
        margin-bottom: 4px;
        color: #ffc107;
      }

      .info-tooltip-box .tooltip-example {
        font-style: italic;
        color: #adb5bd;
        margin-top: 6px;
        font-size: 12px;
      }

      /* Desktop hover behavior */
      @media (hover: hover) and (pointer: fine) {
        .info-tooltip-container:hover .info-tooltip-box {
          visibility: visible;
          opacity: 1;
        }
      }

      /* Mobile adjustments for tooltips */
      @media (max-width: 768px) {
        .info-tooltip-box {
          min-width: 180px;
          max-width: 250px;
          left: 0;
          transform: translateX(0);
        }

        .info-tooltip-box::before {
          left: 9px;
          transform: translateX(0);
        }

        .info-tooltip-icon {
          width: 20px;
          height: 20px;
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Backstock Inventory Application</h1>

      <div class="menu-section">
        <!-- CSV Upload -->
        <div class="csv-upload">
          <form role="form" name="add-csv-form" method="POST" action="/" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
              <label for="csv-input">Add .csv File:</label>
              <input type="file" class="form-control-file" name="csv-input" id="csv" accept=".csv">
              <input type="submit" name="csv-submit" value="Upload CSV" />
            </div>
          </form>
        </div>

        <!-- Menu Buttons -->
        <div class="menu-buttons">
          <form role="form" name="add-item-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button name="add-item" id="add" type="submit" class="btn btn-menu">Add Item</button>
          </form>
          <form role="form" name="search-item-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button name="search-item" id="search" type="submit" class="btn btn-menu">Search Item</button>
          </form>
          <form role="form" name="add-random-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <!-- Random Item Count Selector -->
            <div class="random-count-selector">
              <label for="random-item-count">Items:</label>
              <div class="range-selector-wrapper">
                <input type="range"
                       name="random-item-count"
                       id="random-item-count"
                       class="range-selector"
                       min="1"
                       max="50"
                       value="5"
                       aria-label="Number of random items to add (1-50)"
                       aria-describedby="random-count-display">
                <span id="random-count-display" class="count-display">5</span>
              </div>
              <div class="range-labels">
                <span>1</span>
                <span>50</span>
              </div>
            </div>
            <button name="add-random" id="random" type="submit" class="btn btn-menu">Add Random Items</button>
          </form>
          <form role="form" name="generate-report-form" method="GET" action="/report" id="report-form">
            <!-- Visualization Selection Dropdown -->
            <div class="viz-selector-container">
              <label for="viz-selector" style="font-weight: bold; margin-bottom: 8px; display: block;">Select Visualizations:</label>
              <div class="viz-dropdown">
                <button type="button" class="viz-dropdown-toggle" id="viz-dropdown-toggle">
                  <span id="viz-selection-text">All Visualizations</span>
                  <span class="viz-caret">â–¼</span>
                </button>
                <div class="viz-dropdown-menu" id="viz-dropdown-menu">
                  <div class="viz-dropdown-header">
                    <label class="viz-checkbox-label">
                      <input type="checkbox" id="select-all-viz" checked> <strong>Select All</strong>
                    </label>
                  </div>
                  <div class="viz-dropdown-divider"></div>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="stock_health" class="viz-checkbox" checked> Stock Level Health
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="department" class="viz-checkbox" checked> Items by Department
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="age" class="viz-checkbox" checked> Inventory Age
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="price_range" class="viz-checkbox" checked> Price Range
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="shelf_life" class="viz-checkbox" checked> Shelf Life
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="top_value" class="viz-checkbox" checked> Top Items by Value
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="top_price" class="viz-checkbox" checked> Top Items by Price
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="reorder_table" class="viz-checkbox" checked> Reorder Alert Table
                  </label>
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-menu" style="margin-top: 12px;">Generate Report</button>
          </form>
        </div>
      </div>
      <!-- Forms Section -->
      <div class="form-section">
        {% if loading_search %}
          <form role="form" name="search-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
              <label for="column-type">Search By:</label>
              <select class="form-control" name="column" id="column-type">
                <option>id</option>
                <option>description</option>
                <option>last_sold</option>
                <option>shelf_life</option>
                <option>department</option>
                <option>price</option>
                <option>unit</option>
                <option>x_for</option>
                <option>cost</option>
                <option>quantity</option>
                <option>reorder_point</option>
                <option>date_added</option>
              </select>
            </div>
            <div class="form-group">
              <label for="item-box">Search Term:</label>
              <input type="text" name="item" class="form-control" id="item-box" placeholder="Enter item description" autofocus required>
            </div>
            <button name="send-search" type="submit" class="btn btn-success">Search</button>
          </form>
        {% elif loading_add_item %}
          <form role="form" name="add-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-id">ID:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about ID">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Item ID</div>
                    Unique identifier for the product, such as a SKU or barcode number.
                    <div class="tooltip-example">Example: SKU-12345 or 041234567890</div>
                  </div>
                </div>
              </div>
              <input type="text" name="id-add" class="form-control" id="add-id" placeholder="Enter ID" autofocus required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-description">Description:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Description">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Description</div>
                    A brief name or description of the product.
                    <div class="tooltip-example">Example: Organic Whole Milk 1 Gallon</div>
                  </div>
                </div>
              </div>
              <input type="text" name="description-add" class="form-control" id="add-description" placeholder="Enter description" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-last-sold">Last Sold:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Last Sold">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Last Sold Date</div>
                    The most recent date this item was sold. Use mm/dd/yyyy format.
                    <div class="tooltip-example">Example: 01/15/2024</div>
                  </div>
                </div>
              </div>
              <input type="text" name="last-sold-add" class="form-control" id="add-last-sold" placeholder="Enter last sold date (mm/dd/yyyy)" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-shelf-life">Shelf Life:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Shelf Life">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Shelf Life</div>
                    How long the product remains sellable or usable. Can be in days, weeks, or months.
                    <div class="tooltip-example">Example: 30 days, 6 months, or 1 year</div>
                  </div>
                </div>
              </div>
              <input type="text" name="shelf-life-add" class="form-control" id="add-shelf-life" placeholder="Enter shelf life" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-department">Department:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Department">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Department</div>
                    The store section or category where this item belongs.
                    <div class="tooltip-example">Example: Dairy, Produce, Bakery, or Frozen</div>
                  </div>
                </div>
              </div>
              <input type="text" name="department-add" class="form-control" id="add-department" placeholder="Enter department" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-price">Price:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Price">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Retail Price</div>
                    The selling price of the item. Enter as a number without currency symbol.
                    <div class="tooltip-example">Example: 3.99 or 12.50</div>
                  </div>
                </div>
              </div>
              <input type="text" name="price-add" class="form-control" id="add-price" placeholder="Enter price" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-unit">Unit of Measurement:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Unit of Measurement">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Unit of Measurement</div>
                    How the item is measured or sold (per piece, weight, volume, etc.).
                    <div class="tooltip-example">Example: each, lb, oz, gallon, or pack</div>
                  </div>
                </div>
              </div>
              <input type="text" name="unit-add" class="form-control" id="add-unit" placeholder="Enter unit of measurement" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-xfor">xFor:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about xFor">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Quantity for Price (xFor)</div>
                    Number of units included in the listed price. Use 1 for single-item pricing, or higher for bundle deals.
                    <div class="tooltip-example">Example: 1 (regular) or 3 (for "3 for $5")</div>
                  </div>
                </div>
              </div>
              <input type="text" name="xfor-add" class="form-control" id="add-xfor" placeholder="Enter xFor" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-cost">Cost:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Cost">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Wholesale Cost</div>
                    The purchase cost of the item from the supplier. Enter as a number without currency symbol.
                    <div class="tooltip-example">Example: 2.50 or 8.00</div>
                  </div>
                </div>
              </div>
              <input type="text" name="cost-add" class="form-control" id="add-cost" placeholder="Enter cost" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-quantity">Quantity in Stock:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Quantity in Stock">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Current Stock Level</div>
                    The number of units currently available in inventory.
                    <div class="tooltip-example">Example: 25, 100, or 0</div>
                  </div>
                </div>
              </div>
              <input type="number" name="quantity-add" class="form-control" id="add-quantity" placeholder="Enter quantity" value="0" required>
            </div>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="add-reorder-point">Reorder Point:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Reorder Point">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Reorder Point</div>
                    Minimum stock level that triggers a reorder alert. When quantity falls to or below this number, you'll be notified to restock.
                    <div class="tooltip-example">Example: 10, 5, or 20</div>
                  </div>
                </div>
              </div>
              <input type="number" name="reorder-point-add" class="form-control" id="add-reorder-point" placeholder="Enter reorder point" value="10" required>
            </div>
            <button name="send-add" type="submit" class="btn btn-success">Add</button>
          </form>
        {% elif loading_add_random %}
          <form role="form" name="random-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <h4>Generate Random Test Items</h4>
            <p style="color: #666; margin-bottom: 15px;">Add randomized grocery items from a curated corpus of common products with realistic pricing.</p>
            <div class="form-group">
              <div class="field-label-wrapper">
                <label for="random-count">Number of Items:</label>
                <div class="info-tooltip-container">
                  <span class="info-tooltip-icon" tabindex="0" role="button" aria-label="More info about Number of Items">i</span>
                  <div class="info-tooltip-box">
                    <div class="tooltip-title">Random Items Count</div>
                    How many random grocery items to generate. Each item will have a unique ID and randomized but realistic values.
                    <div class="tooltip-example">Range: 1-50 items</div>
                  </div>
                </div>
              </div>
              <input type="number" name="random-count" class="form-control" id="random-count" placeholder="Enter number of items" value="5" min="1" max="50" required>
            </div>
            <button name="send-random" type="submit" class="btn btn-success">Generate Items</button>
          </form>
        {% endif %}
      </div>
      <!-- Error Messages -->
      {% if errors %}
        <div class="results-section">
          {% for error in errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Results Section -->
      <div class="results-section">
        {% if random_added %}
          <div class="success-message">Successfully generated {{ random_count }} random item(s)!</div>
        {% elif item_added %}
          {% for item in items %}
            <div class="success-message">Item with ID: {{ item.id }} successfully added!</div>
          {% endfor %}
        {% elif item_searched %}
          <h4>Search Results:</h4>
          {% for item in items %}
            <div class="item-card">
              <div class="item-detail"><strong>ID:</strong> {{ item['id'] }}</div>
              <div class="item-detail"><strong>Description:</strong> {{ item['description'] }}</div>
              <div class="item-detail"><strong>Last Sold:</strong> {{ item['last_sold'] }}</div>
              <div class="item-detail"><strong>Shelf Life:</strong> {{ item['shelf_life'] }}</div>
              <div class="item-detail"><strong>Department:</strong> {{ item['department'] }}</div>
              <div class="item-detail"><strong>Price:</strong> {{ item['price'] }}</div>
              <div class="item-detail"><strong>Unit:</strong> {{ item['unit'] }}</div>
              <div class="item-detail"><strong>xFor:</strong> {{ item['x_for'] }}</div>
              <div class="item-detail"><strong>Cost:</strong> {{ item['cost'] }}</div>
              <div class="item-detail"><strong>Quantity:</strong> {{ item['quantity'] }}</div>
              <div class="item-detail"><strong>Reorder Point:</strong> {{ item['reorder_point'] }}</div>
              <div class="item-detail"><strong>Date Added:</strong> {{ item['date_added'] }}</div>
            </div>
          {% endfor %}
        {% else %}
          {% for item in items %}
            <div class="item-card">{{ item }}</div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
      <p>Created by: Alex Thola | Contact: <a href="mailto:alexthola@gmail.com">alexthola@gmail.com</a></p>
    </footer>

    <script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script>
      // Random item count selector functionality
      (function() {
        const rangeInput = document.getElementById('random-item-count');
        const countDisplay = document.getElementById('random-count-display');

        if (!rangeInput || !countDisplay) return;

        // Update display and progress bar
        function updateRangeDisplay() {
          const value = rangeInput.value;
          countDisplay.textContent = value;

          // Calculate progress percentage for gradient background
          const min = parseInt(rangeInput.min);
          const max = parseInt(rangeInput.max);
          const progress = ((value - min) / (max - min)) * 100;
          rangeInput.style.setProperty('--range-progress', progress + '%');
        }

        // Initialize display
        updateRangeDisplay();

        // Update on input (real-time as slider moves)
        rangeInput.addEventListener('input', updateRangeDisplay);

        // Also update on change for compatibility
        rangeInput.addEventListener('change', updateRangeDisplay);
      })();

      // Visualization selector functionality
      (function() {
        const dropdownToggle = document.getElementById('viz-dropdown-toggle');
        const dropdownMenu = document.getElementById('viz-dropdown-menu');
        const selectAllCheckbox = document.getElementById('select-all-viz');
        const vizCheckboxes = document.querySelectorAll('.viz-checkbox');
        const selectionText = document.getElementById('viz-selection-text');

        if (!dropdownToggle || !dropdownMenu) return;

        // Toggle dropdown
        dropdownToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          dropdownMenu.classList.toggle('show');
          dropdownToggle.classList.toggle('open');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
          if (!dropdownToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.remove('show');
            dropdownToggle.classList.remove('open');
          }
        });

        // Prevent dropdown from closing when clicking inside
        dropdownMenu.addEventListener('click', function(e) {
          e.stopPropagation();
        });

        // Update selection text
        function updateSelectionText() {
          const checkedCount = document.querySelectorAll('.viz-checkbox:checked').length;
          const totalCount = vizCheckboxes.length;

          if (checkedCount === 0) {
            selectionText.textContent = 'No visualizations selected';
          } else if (checkedCount === totalCount) {
            selectionText.textContent = 'All Visualizations';
          } else if (checkedCount === 1) {
            const checkedBox = document.querySelector('.viz-checkbox:checked');
            selectionText.textContent = checkedBox.parentElement.textContent.trim();
          } else {
            selectionText.textContent = checkedCount + ' visualizations selected';
          }

          // Update select all checkbox state
          if (selectAllCheckbox) {
            selectAllCheckbox.checked = checkedCount === totalCount;
            selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < totalCount;
          }
        }

        // Select/deselect all
        if (selectAllCheckbox) {
          selectAllCheckbox.addEventListener('change', function() {
            const isChecked = this.checked;
            vizCheckboxes.forEach(function(checkbox) {
              checkbox.checked = isChecked;
            });
            updateSelectionText();
          });
        }

        // Individual checkbox changes
        vizCheckboxes.forEach(function(checkbox) {
          checkbox.addEventListener('change', updateSelectionText);
        });

        // Initialize
        updateSelectionText();
      })();

      // Info tooltip functionality for mobile and desktop
      (function() {
        const tooltipIcons = document.querySelectorAll('.info-tooltip-icon');
        let activeTooltip = null;

        // Check if device has touch support
        const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

        tooltipIcons.forEach(function(icon) {
          const tooltipBox = icon.nextElementSibling;
          if (!tooltipBox) return;

          // Click/tap handler for mobile and as alternative for desktop
          icon.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();

            // If this tooltip is already active, close it
            if (activeTooltip === tooltipBox) {
              tooltipBox.classList.remove('show');
              activeTooltip = null;
              return;
            }

            // Close any other open tooltip
            if (activeTooltip) {
              activeTooltip.classList.remove('show');
            }

            // Open this tooltip
            tooltipBox.classList.add('show');
            activeTooltip = tooltipBox;
          });

          // Keyboard accessibility - open on Enter or Space
          icon.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              icon.click();
            }
          });
        });

        // Close tooltip when clicking outside
        document.addEventListener('click', function(e) {
          if (activeTooltip && !e.target.closest('.info-tooltip-container')) {
            activeTooltip.classList.remove('show');
            activeTooltip = null;
          }
        });

        // Close tooltip when touching outside (for mobile)
        document.addEventListener('touchstart', function(e) {
          if (activeTooltip && !e.target.closest('.info-tooltip-container')) {
            activeTooltip.classList.remove('show');
            activeTooltip = null;
          }
        });

        // Close tooltip on Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && activeTooltip) {
            activeTooltip.classList.remove('show');
            activeTooltip = null;
          }
        });
      })();
    </script>
  </body>
</html>

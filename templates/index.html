<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Backstock Inventory</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style>
      /* Global Styles */
      body {
        padding-bottom: 80px; /* Space for footer */
        font-size: 16px; /* Better base font size for mobile */
      }

      .container {
        max-width: 1200px;
        padding: 15px;
      }

      /* Header */
      h1 {
        font-size: 1.8rem;
        margin-bottom: 20px;
      }

      h4 {
        margin-top: 15px;
        margin-bottom: 15px;
      }

      /* Menu Buttons */
      .menu-section {
        margin-bottom: 30px;
      }

      .menu-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
        clear: both;
      }

      .btn-menu {
        background-color: #CE2029;
        border-color: #CE2029;
        color: white;
        width: 100%;
        min-height: 44px; /* Better touch target */
        font-size: 16px;
        padding: 10px 15px;
        display: block;
      }

      .btn-menu:hover,
      .btn-menu:focus {
        background-color: #a31920;
        border-color: #a31920;
        color: white;
      }

      /* CSV Upload Section */
      .csv-upload {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 25px;
        width: 100%;
        clear: both;
      }

      .csv-upload label {
        font-weight: bold;
        margin-bottom: 8px;
      }

      .csv-upload input[type="submit"] {
        margin-top: 10px;
        min-height: 44px;
        padding: 10px 20px;
        background-color: #CE2029;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .csv-upload input[type="submit"]:hover {
        background-color: #a31920;
      }

      /* Forms */
      .form-section {
        max-width: 600px;
        margin: 0 auto;
      }

      .form-group label {
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
      }

      .form-control {
        width: 100%;
        max-width: 100%;
        min-height: 44px;
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 10px;
      }

      select.form-control {
        height: 44px;
      }

      .btn-success {
        min-height: 44px;
        padding: 10px 30px;
        font-size: 16px;
        margin-top: 10px;
      }

      /* Results Display */
      .results-section {
        margin-top: 20px;
      }

      .item-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        padding: 15px;
        margin-bottom: 15px;
      }

      .item-card h5 {
        margin: 0 0 10px 0;
        font-size: 1rem;
        word-wrap: break-word;
      }

      .item-detail {
        margin: 5px 0;
        font-size: 0.9rem;
      }

      .item-detail strong {
        display: inline-block;
        min-width: 120px;
      }

      /* Error Messages */
      .error-message {
        color: #d9534f;
        background-color: #f2dede;
        border: 1px solid #ebccd1;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
      }

      /* Success Messages */
      .success-message {
        color: #3c763d;
        background-color: #dff0d8;
        border: 1px solid #d6e9c6;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
      }

      /* Footer */
      .page-footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: #f8f9fa;
        border-top: 1px solid #dee2e6;
        padding: 15px;
        text-align: center;
        font-size: 0.9rem;
        z-index: 1000;
      }

      .page-footer p {
        margin: 0;
      }

      /* Mobile Optimizations */
      @media (max-width: 768px) {
        h1 {
          font-size: 1.5rem;
        }

        .menu-buttons {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .csv-upload {
          margin-bottom: 20px;
        }

        .container {
          padding: 10px;
        }

        .item-detail strong {
          display: block;
          margin-bottom: 2px;
        }

        .page-footer {
          font-size: 0.8rem;
          padding: 10px 5px;
        }
      }

      /* Tablet Optimizations */
      @media (min-width: 769px) and (max-width: 1024px) {
        .menu-buttons {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      /* Visualization Selector Styles */
      .viz-selector-container {
        margin-bottom: 10px;
        width: 100%;
      }

      .viz-dropdown {
        position: relative;
        width: 100%;
      }

      .viz-dropdown-toggle {
        width: 100%;
        min-height: 44px;
        padding: 10px 15px;
        background-color: white;
        border: 2px solid #CE2029;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 16px;
        color: #333;
        transition: all 0.3s;
      }

      .viz-dropdown-toggle:hover {
        background-color: #f8f9fa;
        border-color: #a31920;
      }

      .viz-dropdown-toggle:focus {
        outline: 2px solid #CE2029;
        outline-offset: 2px;
      }

      .viz-caret {
        font-size: 12px;
        transition: transform 0.3s;
      }

      .viz-dropdown-toggle.open .viz-caret {
        transform: rotate(180deg);
      }

      .viz-dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        margin-top: 5px;
        background-color: white;
        border: 2px solid #CE2029;
        border-radius: 4px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        max-height: 400px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
      }

      .viz-dropdown-menu.show {
        display: block;
      }

      .viz-dropdown-header {
        padding: 12px 15px;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
      }

      .viz-dropdown-divider {
        height: 1px;
        background-color: #dee2e6;
        margin: 0;
      }

      .viz-checkbox-label {
        display: block;
        padding: 12px 15px;
        cursor: pointer;
        user-select: none;
        transition: background-color 0.2s;
        font-size: 16px;
      }

      .viz-checkbox-label:hover {
        background-color: #f8f9fa;
      }

      .viz-checkbox-label input[type="checkbox"] {
        margin-right: 10px;
        width: 18px;
        height: 18px;
        cursor: pointer;
        vertical-align: middle;
      }

      /* Mobile-specific adjustments */
      @media (max-width: 768px) {
        .viz-dropdown-menu {
          max-height: 300px;
        }

        .viz-checkbox-label {
          padding: 14px 15px;
          font-size: 16px;
        }

        .viz-checkbox-label input[type="checkbox"] {
          width: 20px;
          height: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Backstock Inventory Application</h1>

      <div class="menu-section">
        <h4>Menu:</h4>

        <!-- CSV Upload -->
        <div class="csv-upload">
          <form role="form" name="add-csv-form" method="POST" action="/" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
              <label for="csv-input">Add .csv File:</label>
              <input type="file" class="form-control-file" name="csv-input" id="csv" accept=".csv">
              <input type="submit" name="csv-submit" value="Upload CSV" />
            </div>
          </form>
        </div>

        <!-- Menu Buttons -->
        <div class="menu-buttons">
          <form role="form" name="add-item-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button name="add-item" id="add" type="submit" class="btn btn-menu">Add Item</button>
          </form>
          <form role="form" name="search-item-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <button name="search-item" id="search" type="submit" class="btn btn-menu">Search Item</button>
          </form>
          <form role="form" name="generate-report-form" method="GET" action="/report" id="report-form">
            <!-- Visualization Selection Dropdown -->
            <div class="viz-selector-container">
              <label for="viz-selector" style="font-weight: bold; margin-bottom: 8px; display: block;">Select Visualizations:</label>
              <div class="viz-dropdown">
                <button type="button" class="viz-dropdown-toggle" id="viz-dropdown-toggle">
                  <span id="viz-selection-text">All Visualizations</span>
                  <span class="viz-caret">â–¼</span>
                </button>
                <div class="viz-dropdown-menu" id="viz-dropdown-menu">
                  <div class="viz-dropdown-header">
                    <label class="viz-checkbox-label">
                      <input type="checkbox" id="select-all-viz" checked> <strong>Select All</strong>
                    </label>
                  </div>
                  <div class="viz-dropdown-divider"></div>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="stock_health" class="viz-checkbox" checked> Stock Level Health
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="department" class="viz-checkbox" checked> Items by Department
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="age" class="viz-checkbox" checked> Inventory Age
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="price_range" class="viz-checkbox" checked> Price Range
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="shelf_life" class="viz-checkbox" checked> Shelf Life
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="top_value" class="viz-checkbox" checked> Top Items by Value
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="top_price" class="viz-checkbox" checked> Top Items by Price
                  </label>
                  <label class="viz-checkbox-label">
                    <input type="checkbox" name="viz" value="reorder_table" class="viz-checkbox" checked> Reorder Alert Table
                  </label>
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-menu" style="margin-top: 12px;">Generate Report</button>
          </form>
        </div>
      </div>
      <!-- Forms Section -->
      <div class="form-section">
        {% if loading_search %}
          <form role="form" name="search-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
              <label for="column-type">Search By:</label>
              <select class="form-control" name="column" id="column-type">
                <option>id</option>
                <option>description</option>
                <option>last_sold</option>
                <option>shelf_life</option>
                <option>department</option>
                <option>price</option>
                <option>unit</option>
                <option>x_for</option>
                <option>cost</option>
                <option>quantity</option>
                <option>reorder_point</option>
                <option>date_added</option>
              </select>
            </div>
            <div class="form-group">
              <label for="item-box">Search Term:</label>
              <input type="text" name="item" class="form-control" id="item-box" placeholder="Enter item description" autofocus required>
            </div>
            <button name="send-search" type="submit" class="btn btn-success">Search</button>
          </form>
        {% elif loading_add_item %}
          <form role="form" name="add-form" method="POST" action="/">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
            <div class="form-group">
              <label for="add-id">ID:</label>
              <input type="text" name="id-add" class="form-control" id="add-id" placeholder="Enter ID" autofocus required>
            </div>
            <div class="form-group">
              <label for="add-description">Description:</label>
              <input type="text" name="description-add" class="form-control" id="add-description" placeholder="Enter description" required>
            </div>
            <div class="form-group">
              <label for="add-last-sold">Last Sold:</label>
              <input type="text" name="last-sold-add" class="form-control" id="add-last-sold" placeholder="Enter last sold date (mm/dd/yyyy)" required>
            </div>
            <div class="form-group">
              <label for="add-shelf-life">Shelf Life:</label>
              <input type="text" name="shelf-life-add" class="form-control" id="add-shelf-life" placeholder="Enter shelf life" required>
            </div>
            <div class="form-group">
              <label for="add-department">Department:</label>
              <input type="text" name="department-add" class="form-control" id="add-department" placeholder="Enter department" required>
            </div>
            <div class="form-group">
              <label for="add-price">Price:</label>
              <input type="text" name="price-add" class="form-control" id="add-price" placeholder="Enter price" required>
            </div>
            <div class="form-group">
              <label for="add-unit">Unit of Measurement:</label>
              <input type="text" name="unit-add" class="form-control" id="add-unit" placeholder="Enter unit of measurement" required>
            </div>
            <div class="form-group">
              <label for="add-xfor">xFor:</label>
              <input type="text" name="xfor-add" class="form-control" id="add-xfor" placeholder="Enter xFor" required>
            </div>
            <div class="form-group">
              <label for="add-cost">Cost:</label>
              <input type="text" name="cost-add" class="form-control" id="add-cost" placeholder="Enter cost" required>
            </div>
            <div class="form-group">
              <label for="add-quantity">Quantity in Stock:</label>
              <input type="number" name="quantity-add" class="form-control" id="add-quantity" placeholder="Enter quantity" value="0" required>
            </div>
            <div class="form-group">
              <label for="add-reorder-point">Reorder Point:</label>
              <input type="number" name="reorder-point-add" class="form-control" id="add-reorder-point" placeholder="Enter reorder point" value="10" required>
            </div>
            <button name="send-add" type="submit" class="btn btn-success">Add</button>
          </form>
        {% endif %}
      </div>
      <!-- Error Messages -->
      {% if errors %}
        <div class="results-section">
          {% for error in errors %}
            <div class="error-message">{{ error }}</div>
          {% endfor %}
        </div>
      {% endif %}

      <!-- Results Section -->
      <div class="results-section">
        {% if item_added %}
          {% for item in items %}
            <div class="success-message">Item with ID: {{ item.id }} successfully added!</div>
          {% endfor %}
        {% elif item_searched %}
          <h4>Search Results:</h4>
          {% for item in items %}
            <div class="item-card">
              <div class="item-detail"><strong>ID:</strong> {{ item['id'] }}</div>
              <div class="item-detail"><strong>Description:</strong> {{ item['description'] }}</div>
              <div class="item-detail"><strong>Last Sold:</strong> {{ item['last_sold'] }}</div>
              <div class="item-detail"><strong>Shelf Life:</strong> {{ item['shelf_life'] }}</div>
              <div class="item-detail"><strong>Department:</strong> {{ item['department'] }}</div>
              <div class="item-detail"><strong>Price:</strong> {{ item['price'] }}</div>
              <div class="item-detail"><strong>Unit:</strong> {{ item['unit'] }}</div>
              <div class="item-detail"><strong>xFor:</strong> {{ item['x_for'] }}</div>
              <div class="item-detail"><strong>Cost:</strong> {{ item['cost'] }}</div>
              <div class="item-detail"><strong>Quantity:</strong> {{ item['quantity'] }}</div>
              <div class="item-detail"><strong>Reorder Point:</strong> {{ item['reorder_point'] }}</div>
              <div class="item-detail"><strong>Date Added:</strong> {{ item['date_added'] }}</div>
            </div>
          {% endfor %}
        {% else %}
          {% for item in items %}
            <div class="item-card">{{ item }}</div>
          {% endfor %}
        {% endif %}
      </div>
    </div>

    <!-- Footer -->
    <footer class="page-footer">
      <p>Created by: Alex Thola | Contact: <a href="mailto:alexthola@gmail.com">alexthola@gmail.com</a></p>
    </footer>

    <script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script>
      // Visualization selector functionality
      (function() {
        const dropdownToggle = document.getElementById('viz-dropdown-toggle');
        const dropdownMenu = document.getElementById('viz-dropdown-menu');
        const selectAllCheckbox = document.getElementById('select-all-viz');
        const vizCheckboxes = document.querySelectorAll('.viz-checkbox');
        const selectionText = document.getElementById('viz-selection-text');

        if (!dropdownToggle || !dropdownMenu) return;

        // Toggle dropdown
        dropdownToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          dropdownMenu.classList.toggle('show');
          dropdownToggle.classList.toggle('open');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
          if (!dropdownToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
            dropdownMenu.classList.remove('show');
            dropdownToggle.classList.remove('open');
          }
        });

        // Prevent dropdown from closing when clicking inside
        dropdownMenu.addEventListener('click', function(e) {
          e.stopPropagation();
        });

        // Update selection text
        function updateSelectionText() {
          const checkedCount = document.querySelectorAll('.viz-checkbox:checked').length;
          const totalCount = vizCheckboxes.length;

          if (checkedCount === 0) {
            selectionText.textContent = 'No visualizations selected';
          } else if (checkedCount === totalCount) {
            selectionText.textContent = 'All Visualizations';
          } else if (checkedCount === 1) {
            const checkedBox = document.querySelector('.viz-checkbox:checked');
            selectionText.textContent = checkedBox.parentElement.textContent.trim();
          } else {
            selectionText.textContent = checkedCount + ' visualizations selected';
          }

          // Update select all checkbox state
          if (selectAllCheckbox) {
            selectAllCheckbox.checked = checkedCount === totalCount;
            selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < totalCount;
          }
        }

        // Select/deselect all
        if (selectAllCheckbox) {
          selectAllCheckbox.addEventListener('change', function() {
            const isChecked = this.checked;
            vizCheckboxes.forEach(function(checkbox) {
              checkbox.checked = isChecked;
            });
            updateSelectionText();
          });
        }

        // Individual checkbox changes
        vizCheckboxes.forEach(function(checkbox) {
          checkbox.addEventListener('change', updateSelectionText);
        });

        // Initialize
        updateSelectionText();
      })();
    </script>
  </body>
</html>